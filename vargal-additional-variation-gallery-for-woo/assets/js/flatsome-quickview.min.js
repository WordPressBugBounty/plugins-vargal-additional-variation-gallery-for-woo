!function(a){"use strict";window.vargal_flatsome_quickview_params={gallery_is_changing:{},default_product_gallery:{}},a(document).on("vargal-gallery-video-rendered",(function(e,t){let r=a(".product-lightbox #product-"+t+" .product-gallery-slider");if(!r.length)return;let l=r.data("flickity");l&&setTimeout((function(a,e){a.resize(),e.find(".slide").css("top","0"),e.find(".vargal-exmage-video").addClass("vargal-flatsome-quickview-video")}),100,l,r)})),a(document).on("vargal-loading-end",(function(e,t){let r=a(".product-lightbox #product-"+t+" .product-gallery");r.length&&(r.removeClass("vargal-product-gallery-loading"),r.find(".vargal-loading").addClass("vargal-hidden"))})),a(document).on("vargal-loading-start",(function(e,t){let r=a(".product-lightbox #product-"+t+" .product-gallery");r.length&&(r.addClass("vargal-product-gallery-loading"),r.find(".vargal-loading").length||a(document).trigger("vargal-loading-render",[r,vargal_params.loading_icon_type]),r.find(".vargal-loading").removeClass("vargal-hidden"))})),a(document).on("clear_reset_announcement",".product-lightbox .variations_form",(function(e){let t=a(this).closest(".variations_form").data("product_id")||a(this).closest(".variations_form").find('[name="product_id"]').val();if(!t)return;vargal_flatsome_quickview_params.default_product_gallery[t]||(vargal_flatsome_quickview_params.default_product_gallery[t]=a(".product-lightbox").find(".slide").clone());let r=a(".product-lightbox #product-"+t+" .product-gallery-slider");r.length&&(a(document).trigger("vargal-loading-start",[t]),r.data("vargal_render_type")||r.data("vargal_render_type","flatsome-quickview"))})),a(document).on("hide_variation",".variations_form",(function(e){let t=a(this).data("product_id")||a(this).find('[name="product_id"]').val();t&&vargal_flatsome_quickview_params.default_product_gallery[t]&&a(document).trigger("vargal-gallery-reset",[t])})),a(document).on("show_variation",".product-lightbox .variations_form",(function(e,t,r){let l=a(this).data("product_id")||a(this).find('[name="product_id"]').val(),i=[];l&&(t?.image&&t?.image_id&&(i=[t.image]),t?.vargal&&(i=i.concat(t.vargal)),a(document).trigger("vargal-gallery-changing",[l,i,t]))})),a(document).on("vargal-gallery-changing",(function(e,t,r,l){if(!t||!a(".product-lightbox").is(":visible"))return;let i=a(".product-lightbox #product-"+t+" .product-gallery-slider");if(!i.length)return;let d=vargal_flatsome_quickview_params.gallery_is_changing[t];if(d?.variation_id&&d.variation_id==l.variation_id)return void a(document).trigger("vargal-loading-end",[t]);if(!r||!r.length)return void a(document).trigger("vargal-loading-end",[t]);if(vargal_flatsome_quickview_params.default_product_gallery[t]||(vargal_flatsome_quickview_params.default_product_gallery[t]=i.find(".slide").clone()),!vargal_flatsome_quickview_params.default_product_gallery[t])return void a(document).trigger("vargal-loading-end",[t]);a(document).trigger("vargal-loading-start",[t]),vargal_flatsome_quickview_params.gallery_is_changing[t]=l,i.find(".wp-post-image").removeClass("wp-post-image"),i.find("img").removeAttr("data-srcset").removeAttr("srcset");let g="",o=[];for(let e in r){let l=r[e],d=a('<div data-thumb="" data-thumb-alt="" data-thumb-srcset="" data-thumb-sizes="" class="woocommerce-product-gallery__image slide"></div>'),n=a('<div class="vargal-html"></div>');d.attr({"data-thumb":l.gallery_thumbnail_src,"data-thumb-alt":l.alt,"data-thumb-srcset":l.gallery_thumbnail_srcset,"data-thumb-sizes":l.gallery_thumbnail_sizes}),l?.is_video?(d.addClass("vargal-video"),d.attr({"data-alt":l.alt,"data-caption":l.caption,"data-title":l.title}),o.push(e),d.append('<video controls><source src="'+l.full_src+'" type="'+l.metadata.mime_type+'"></video>'),l?.poster&&d.find("video").attr({poster:l.poster})):(d.append(vargal_flatsome_quickview_params.default_product_gallery[t].find("img").eq(0).clone()),d.find("img").attr({"data-large_image_height":l.full_src_h,"data-large_image_width":l.full_src_w,"data-large_image":l.full_src,"data-src":l.full_src,alt:l.alt,"data-caption":l.caption,title:l.title,sizes:l.sizes,srcset:l.srcset,width:l.src_w,height:l.src_h,src:l.src}),d.find("img").removeAttr("data-src"),d.find("img").removeAttr("data-o_data-src"),d.find("img").removeAttr("data-srcset"),d.find("img").removeAttr("data-o_data-srcset"),d.find("img").removeAttr("data-o_srcset"),["image/gif"].includes(l.mime_type)&&(d.find("img").removeAttr("srcset"),d.find("img").attr({src:l.full_src})),l.srcset||d.find("img").removeAttr("srcset"));let s=a(document).triggerHandler("vargal_frontend_get_attachment_html",[d,l,i]);n.html(s||d),g+=n.html()}a(document).triggerHandler("vargal-flatsome-quickview-gallery-render",[t,r,l,o,g])?a(document).trigger("vargal-loading-end",[t]):a(document).trigger("vargal-flatsome-quickview-gallery-slider-render",[a(g),i,t])})),a(document).on("vargal-flatsome-quickview-gallery-slider-render",(function(e,t,r,l){let i=a(r);if(!i.length||!t.length)return void a(document).trigger("vargal-loading-end",[l]);let d=a(r).data("flickity");if(!d)return void a(document).trigger("vargal-loading-end",[l]);let g=a(t).length;a(t).find("img").removeClass("wp-post-image lazyloading");for(let a=d.cells.length-1;a>=0;a--)d.remove(d.cells[a].element);for(let e=0;e<g;e++){let r=a(t).eq(e);0===e&&r.find("img").addClass("vargal-wp-post-image"),i.find(".flickity-slider").append(r),d.append(r)}setTimeout((function(a,e){a.resize(),e.find(".slide").css("top","0"),e.find(".vargal-exmage-video").addClass("vargal-flatsome-quickview-video")}),100,d,i),i.find(".vargal-wp-post-image").one("load",(function(){a(this).removeClass("vargal-wp-post-image").addClass("wp-post-image"),a(document).trigger("vargal-loading-end",[l])}))})),a(document).on("vargal-gallery-reset",(function(e,t){if(!t||!a(".product-lightbox").is(":visible"))return;let r=a(".product-lightbox #product-"+t+" .product-gallery-slider");r.length&&(a(document).trigger("vargal-loading-start",[t]),a(document).triggerHandler("vargal-flatsome-quickview-gallery-reset",[t])?a(document).trigger("vargal-loading-end",[t]):vargal_flatsome_quickview_params.default_product_gallery[t]&&vargal_flatsome_quickview_params.gallery_is_changing[t]&&"default"!==vargal_flatsome_quickview_params.gallery_is_changing[t]?(vargal_flatsome_quickview_params.gallery_is_changing[t]="default",a(document).trigger("vargal-flatsome-quickview-gallery-slider-render",[vargal_flatsome_quickview_params.default_product_gallery[t],r,t])):a(document).trigger("vargal-loading-end",[t]))}))}(jQuery);