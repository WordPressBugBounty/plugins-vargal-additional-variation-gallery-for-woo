jQuery(document).ready((function(e){"use strict";e(document.body).on("wc-enhanced-select-init",(function(){e(".vargal-settings:not(.vargal-settings-init)").each((function(a,t){e(t).vargal_settings_init()}))})),e(document).on("dokan_variations_loaded.dokan-product-variation-wrapper, dokan_variations_added.dokan-product-variation-wrapper",(function(){e(".vargal-settings:not(.vargal-settings-init)").each((function(a,t){e(t).vargal_settings_init()}))})),e.fn.vargal_settings_init=function(){let e=new vargal_setting_init(this);return e.init(),e.sortable(),this},window.vargal_setting_init=function(a){this.$gallery=a,this.gallery_input_name=a.data("gallery_input_name"),this.upload_frame=null;let t=this,i=t.$gallery;this.init=function(){i.addClass("vargal-settings-init"),i.closest(".woocommerce_variation").find(".form-flex-box").after(i),i.closest(".dokan-product-variation-itmes").find(".variable_pricing").before(i),e(document).trigger("vargal-settings-init",t),i.on("click",".vargal-settings-header",(function(){i.hasClass("closed")?(i.removeClass("closed"),i.find(".vargal-settings-content").slideDown(300)):(i.addClass("closed"),i.find(".vargal-settings-content").slideUp(300))})),i.on("click",".vargal-img-delete",(function(){e(this).closest(".vargal-img-selected").remove(),t.update()})),i.on("click",".vargal-btn-upload",(function(){if(t.upload_frame)return void t.upload_frame.open();let e=wp.media({title:vargal_params.upload_frame_title,button:{text:vargal_params.upload_frame_btn},library:{type:["image","video"]},multiple:!0});e.on("select",(function(){e.state().get("selection").map((function(e){t.render_img(e.toJSON())}))})),t.upload_frame=e,t.upload_frame.open()}))},this.render_img=function(a){if(!a?.id||i.find(".vargal-img-selected-"+a.id).length)return void e(document.body).trigger("villatheme_show_message",[vargal_params.duplicate_img_mes,["vargal-img-notice"],"",!1,1500]);let n,r,l=a?.type,s=a?.subtype;if(!["image","video"].includes(l))return void e(document.body).trigger("villatheme_show_message",[vargal_params.invalid_type_mes,["vargal-img-error","error"],"",!1,5500]);if("video"===l&&!["mp4","webm"].includes(s))return void e(document.body).trigger("villatheme_show_message",[vargal_params.invalid_video_mes,["vargal-img-error","error"],"",!1,5500]);let o=e('<div class="vargal-img vargal-img-selected vargal-img-selected-'+a.id+'"><input type="hidden" name="'+t.gallery_input_name+'" value="'+a.id+'"><span class="vargal-img-delete"><i class="dashicons dashicons-dismiss"></i></span></div>');n=a?.url,r=e(document).triggerHandler("vargal_get_attachment_html",[a,l,n]),void 0===r&&("image"===l?(a?.sizes?.thumbnail?.url?n=a.sizes.thumbnail.url:a?.sizes?.medium?.url?n=a.sizes.medium.url:a?.sizes?.large?.url?n=a.sizes.large.url:a?.sizes?.full?.url&&(n=a.sizes.full.url),r=n?'<img src="'+n+'">':""):(o.addClass("vargal-thumb-video"),r=n?'<video preload="metadata" src="'+n+'"></video>':"")),r&&(o.append(r),i.find(".vargal-btn-upload").before(o),t.update())},this.sortable=function(){i.find(".vargal-settings-content").sortable({items:".vargal-img-selected",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"vargal-sortable-placeholder",start:function(e,a){a.item.css("background-color","#f6f6f6")},stop:function(e,a){a.item.removeAttr("style")},update:function(){t.update()}})},this.update=function(){t.sortable(),i.closest(".woocommerce_variation").addClass("variation-needs-update"),e("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),e(document).trigger("vargal-settings-updated",t)}}}));