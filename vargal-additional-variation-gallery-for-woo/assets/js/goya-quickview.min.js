!function(a){"use strict";window.vargal_goya_quickview_params={gallery_is_changing:{},default_product_gallery:{}},a(document).on("vargal-loading-end",(function(e,t){let r=a("#et-quickview #product-"+t+" .et-qv-product-image");r.length&&(r.removeClass("vargal-product-gallery-loading"),r.find(".vargal-loading").addClass("vargal-hidden"))})),a(document).on("vargal-loading-start",(function(e,t){let r=a("#et-quickview #product-"+t+" .et-qv-product-image");r.length&&(r.addClass("vargal-product-gallery-loading"),r.find(".vargal-loading").length||a(document).trigger("vargal-loading-render",[r,vargal_params.loading_icon_type]),r.find(".vargal-loading").removeClass("vargal-hidden"))})),a(document).on("clear_reset_announcement","#et-quickview .variations_form",(function(e){let t=a(this).closest(".variations_form").data("product_id")||a(this).closest(".variations_form").find('[name="product_id"]').val();if(!t)return;vargal_goya_quickview_params.default_product_gallery[t]||(vargal_goya_quickview_params.default_product_gallery[t]=a("#et-quickview").find(".slick-slide:not(.slick-cloned)").length?a("#et-quickview").find(".slick-slide:not(.slick-cloned) .woocommerce-product-gallery__image").clone():a("#et-quickview").find(".woocommerce-product-gallery__image").clone());let r=a("#et-quickview #product-"+t+" .et-qv-product-image");r.length&&(a(document).trigger("vargal-loading-start",[t]),r.data("vargal_render_type")||r.data("vargal_render_type","goya-quickview"))})),a(document).on("hide_variation",".variations_form",(function(e){let t=a(this).data("product_id")||a(this).find('[name="product_id"]').val();t&&vargal_goya_quickview_params.default_product_gallery[t]&&a(document).trigger("vargal-gallery-reset",[t])})),a(document).on("show_variation","#et-quickview .variations_form",(function(e,t,r){let i=a(this).data("product_id")||a(this).find('[name="product_id"]').val(),l=[];i&&(t?.image&&t?.image_id&&(l=[t.image]),t?.vargal&&(l=l.concat(t.vargal)),a(document).trigger("vargal-gallery-changing",[i,l,t]))})),a(document).on("vargal-gallery-changing",(function(e,t,r,i){if(!t||!a("#et-quickview").is(":visible"))return;let l=a("#et-quickview #product-"+t+" .et-quickview-gallery-slider");if(!l.length)return;let g=vargal_goya_quickview_params.gallery_is_changing[t];if(g?.variation_id&&g.variation_id==i.variation_id)return void a(document).trigger("vargal-loading-end",[t]);if(!r||!r.length)return void a(document).trigger("vargal-loading-end",[t]);if(vargal_goya_quickview_params.default_product_gallery[t]||(vargal_goya_quickview_params.default_product_gallery[t]=l.find(".slick-slide:not(.slick-cloned) .woocommerce-product-gallery__image").clone()),!vargal_goya_quickview_params.default_product_gallery[t])return void a(document).trigger("vargal-loading-end",[t]);if(!(1!==r.length||i?.vargal&&i.vargal.length)){if(!l.find(".slick-slide").length)return void a(document).trigger("vargal-loading-end",[t]);let e=!1;for(let a=0;a<vargal_goya_quickview_params.default_product_gallery[t].length;a++){let i=jQuery(vargal_goya_quickview_params.default_product_gallery[t][a]).find("img").attr("src");if(i==r[0]?.full_src||i==r[0]?.url||i==r[0]?.src){e=a;break}}if(!1!==e)return a(document).trigger("vargal-gallery-reset",[t]),void setTimeout((function(){l.slick("slickGoTo",e)}),500)}a(document).trigger("vargal-loading-start",[t]),vargal_goya_quickview_params.gallery_is_changing[t]=i,l.find(".wp-post-image").removeClass("wp-post-image"),l.find("img").removeAttr("data-srcset").removeAttr("srcset");let d="",o=[];for(let e in r){let i=r[e],g=a('<div data-thumb="" data-thumb-alt="" data-thumb-srcset="" data-thumb-sizes="" class="woocommerce-product-gallery__image"></div>'),n=a('<div class="vargal-html"></div>');g.append('<a href="'+i.full_src+'"></a>'),g.attr({"data-thumb":i.gallery_thumbnail_src,"data-thumb-alt":i.alt,"data-thumb-srcset":i.gallery_thumbnail_srcset,"data-thumb-sizes":i.gallery_thumbnail_sizes}),i?.is_video?(g.addClass("vargal-video"),g.attr({"data-alt":i.alt,"data-caption":i.caption,"data-title":i.title}),o.push(e),g.find("a").append('<video controls><source src="'+i.full_src+'" type="'+i.metadata.mime_type+'"></video>'),i?.poster&&g.find("video").attr({poster:i.poster})):(g.find("a").append(vargal_goya_quickview_params.default_product_gallery[t].find("img").eq(0).clone()),g.find("img").attr({"data-large_image_height":i.full_src_h,"data-large_image_width":i.full_src_w,"data-large_image":i.full_src,"data-src":i.full_src,alt:i.alt,"data-caption":i.caption,title:i.title,sizes:i.sizes,srcset:i.srcset,width:i.src_w,height:i.src_h,src:i.src}),g.find("img").removeAttr("data-src"),g.find("img").removeAttr("data-o_data-src"),g.find("img").removeAttr("data-srcset"),g.find("img").removeAttr("data-o_data-srcset"),g.find("img").removeAttr("data-o_srcset"),["image/gif"].includes(i.mime_type)&&(g.find("img").removeAttr("srcset"),g.find("img").attr({src:i.full_src})),i.srcset||g.find("img").removeAttr("srcset"));let c=a(document).triggerHandler("vargal_frontend_get_attachment_html",[g,i,l]);n.html(c||g),d+=n.html()}a(document).triggerHandler("vargal-goya-quickview-gallery-render",[t,r,i,o,d])?a(document).trigger("vargal-loading-end",[t]):a(document).trigger("vargal-goya-quickview-gallery-slider-render",[a(d),l,t])})),a(document).on("vargal-goya-quickview-gallery-slider-render",(function(e,t,r,i){let l=a(r);if(!l.length||!t.length)return void a(document).trigger("vargal-loading-end",[i]);if(!l.find(".slick-slide").length)return void a(document).trigger("vargal-loading-end",[i]);let g=a(t).length;a(t).find("img").removeClass("wp-post-image lazyloading");for(let a=l.slick("getSlick").slideCount-1;a>=0;a--)l.slick("slickRemove",a);for(let e=0;e<g;e++){let r=a(t).eq(e);0===e&&r.find("img").addClass("vargal-wp-post-image"),l.slick("slickAdd",r)}l.find(".vargal-wp-post-image").one("load",(function(){a(this).removeClass("vargal-wp-post-image").addClass("wp-post-image"),a(document).trigger("vargal-loading-end",[i])}))})),a(document).on("vargal-gallery-reset",(function(e,t){if(!t||!a("#et-quickview").is(":visible"))return;let r=a("#et-quickview #product-"+t+" .et-quickview-gallery-slider");r.length&&(a(document).trigger("vargal-loading-start",[t]),a(document).triggerHandler("vargal-goya-quickview-gallery-reset",[t])?a(document).trigger("vargal-loading-end",[t]):vargal_goya_quickview_params.default_product_gallery[t]&&vargal_goya_quickview_params.gallery_is_changing[t]&&"default"!==vargal_goya_quickview_params.gallery_is_changing[t]?(vargal_goya_quickview_params.gallery_is_changing[t]="default",a(document).trigger("vargal-goya-quickview-gallery-slider-render",[vargal_goya_quickview_params.default_product_gallery[t],r,t])):a(document).trigger("vargal-loading-end",[t]))}))}(jQuery);